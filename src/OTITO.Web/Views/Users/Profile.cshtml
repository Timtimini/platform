@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@model OTITO.Web.Models.User.UserProfile

<div class="container mainContainer" ng-app="User" ng-controller="Profile">
    <div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;background:#000;opacity:0.5;"
         ng-show="processing">
    </div>
    <div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:9998;"
         ng-show="processing">

        <div class="spinner-border" style="width: 3rem; height: 3rem; position:absolute;top:50%;left:50%; " role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <div class="row delegate mt-10">

        <div class="col-lg-6">

            <div class="row">

                <div class="col-lg-8">
                    <h1 class="username">@Model.Name</h1>
                    @*<p class="location">San Francisco CA</p>*@
                </div>
            </div>
            <div class="row mt-20">
                <div class="col-lg-12 karma_block">
                    <h1 class="heading">Positive Karma</h1>
                    <div class="bar mt-10">
                        <div class="filled_blue " style="width:@Model.PositiveKarma%"></div>
                    </div>
                </div>
            </div>
            <div class="row mt-20">
                <div class="col-lg-12 karma_block">
                    <h1 class="heading">Negative Karma</h1>
                    <div class="bar mt-10">
                        <div class="filled_red " style="width:@Model.NegativeKarma%"></div>
                    </div>
                </div>
            </div>
            @if(!Model.IsSocial)
            {
            <div class="row mt-20">
                <button class="btn btn-success" ng-click="gotoChangePassword()">
                    Change Password
                </button>
            </div>
            }

        </div>
        <div class="col-lg-6">

            <div class="row delegate">
                <h1 class="username">Recent Activity</h1>
            </div>
            @foreach (var item in Model.Activity)
            {
                <div class="row activity_claim_row">

                    <div class="col-lg-12 activity_claim_cont">
                        <h1 class="claim_head">
                            @item.Title
                        </h1>
                        @*<button class="btn btn-success min-width-120" onclick="window.location.href='@(
                  item.ClaimId==0?"/Contribution/TopicEditorView?TopicId="+item.TopicId:
                  "/Contribution/ViewSources?TopicId="+item.TopicId+"&ClaimId="+item.ClaimId
                )'">
                            View
                        </button>*@
                        <button class="btn btn-success min-width-120" onclick="window.location.href='@item.URL'">
                            View
                        </button>
                    </div>
                </div>
            }


        </div>
    </div>

</div>

@section Scripts{

<script type="text/javascript">
var app = angular.module('User', ['angularModalService']);
    app.controller('Profile', ['$scope','$http','ModalService',function($scope, $http,ModalService) {
        $scope.gotoChangePassword=function()
    {

        ModalService.showModal({
                templateUrl: 'ChangePasswordModal',
                controller: "ModalController",
                inputs: {
                    UserInput:'_3xl9'
                }
            }).then(function (modal) {

                modal.element.modal();
                modal.close.then(function (result) {

    console.log(result);
                });
            });



    }
}]);

app.controller('ModalController', ['$scope', '$http', 'close', 'UserInput', function ($scope, $http, close, UserInput) {

    $scope.CurrentPassword='';
    $scope.NewPassword='';
    $scope.ConfirmNewPassword='';
    $scope.CurrentPasswordError=false;
    $scope.NewPasswordError=false;
    $scope.ConfirmNewPasswordError=false;
    $scope.PasswordMatchError=false;
    console.log($scope.CurrentPasswordError);
    $scope.ChangePasswordBack=function()
    {

    $scope.CurrentPasswordError=false;
    $scope.NewPasswordError=false;
    $scope.ConfirmNewPasswordError=false;
    $scope.PasswordMatchError=false;

        if(!$scope.CurrentPassword)
    {
        $scope.CurrentPasswordError=true;

    }
    if(!$scope.NewPassword)
    {
        $scope.NewPasswordError=true;
    }
    if(!$scope.ConfirmNewPassword)
    {
        $scope.ConfirmNewPasswordError=true;
    }

        if(!($scope.NewPassword===$scope.ConfirmNewPassword))
        {
            $scope.PasswordMatchError=true;

        }

        if(!$scope.CurrentPasswordError && !$scope.NewPasswordError && !$scope.ConfirmNewPasswordError && !$scope.PasswordMatchError)
    {
        //good to go

        $scope.$parent.processing=true;


        $http({
        url: '@Url.Action("ChangePassword")',
        method: "POST",
    headers: {
   'Content-Type': "application/json",
    },
        data: {
            PreviousPassword:$scope.CurrentPassword,
            NewPassword:$scope.NewPassword
    }

    })
    .then(function(response) {

     $scope.$parent.processing=false;
    if(response.data.success)
    {
        alert(response.data.message);
        close({test:1}, 0);
        $(".modal-backdrop").hide();
    }
    else
    {
        alert(response.data.message);
    }

    },
    function(response) { // optional
            // failed
    $scope.$parent.processing=false;
    alert(response.data.message);
    });

    }
    }



}]);
</script>
}